<!-- TODO: better document workflow output (e.g. https://github.com/nf-core/viralrecon/blob/master/docs/output.md) --> 
# nhhaidee/scovtree: Output

## Introduction

This document describes the output produced by the pipeline. Most of the plots are taken from the MultiQC report, which summarises results at the end of the pipeline.

The directories listed below will be created in the results directory after the pipeline has finished. All paths are relative to the top-level results directory.

<!-- TODO nf-core: Write this documentation describing your workflow's output -->

## Pipeline overview

The pipeline is built using [Nextflow](https://www.nextflow.io/)
and processes data using the following steps:

<!-- TODO: Add pipeline steps -->

1. [Pangolin](#pangolin) lineage assignment
2. [Filtering GISAID sequences](#filtering-gisaid-sequences) (if specified) 
3. [Multiple sequence alignment](#multiple-sequence-alignment)


### Pangolin

<details markdown="1">
<summary>Output files</summary>

* `pangolin/pangolin.csv`: [Pangolin] lineage assignment results. 

</details>

Assign input sequences to [Pangolin] SARS-CoV-2 global lineages. This lineage info is used for filtering GISAID sequences and also shown in the [shiptv] tree. 

### Filtering GISAID sequences

If both GISAID sequences (`--gisaid_sequences`) and metadata (`--gisaid_metadata`) are specified, the GISAID sequences belonging to the same [Pangolin] lineages as the `--input` sequences will be filtered for. Poor quality sequences will be filtered out (too long; too short; too many ambiguous sites).

## Phylogenetic Analysis

**Output files:**

* `phylogenetic_analysis/`
  * `filter_gisaid`: directory containing filtered sequences, metadata and statistics of filtering step.
  * `filter_msa`: directory containing results of filtering multiple sequence alignment to manageable number of sequences (typically  < 10,000 sequences).
  * `iqtree`: directory containing results of building phylogenetic tree using IQTree tool.
  * `nextalign`: directory containing results of Multiple Sequence Alignment using nextalign tool.
  * `mafft`: directory containing results of Multiple Sequence Alignment using mafft tool.  
  * `pangolin`: directory containing pangolin lineage report for input consensus sequences.
  * `subtree`: directory containing results of pruning tree to number of taxa  < max_taxa so that it can be view easily with Shiptv
  * `shiptv_visualization`: directory containing visualization of phylogenetic tree using Shiptv tool.
  * `merge_metadata`: directory containing tsv file in which merging gisaid metatdata and aa substitution change, this result is used for visualization with shiptv.
  * `nextclade`: directory containing results of running nextclade for sequences and containing aa substitution change.

## Pipeline information

[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.

**Output files:**

* `pipeline_info/`
  * Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.dot`/`pipeline_dag.svg`.
  * Reports generated by the pipeline: `pipeline_report.html`, `pipeline_report.txt` and `software_versions.csv`.
  * Documentation for interpretation of results in HTML format: `results_description.html`.

<!-- TODO: add links to tools used in this pipeline -->
[Nextalign]: https://github.com/nextstrain/nextclade/tree/master/packages/nextalign_cli
[Nextclade]: https://github.com/nextstrain/nextclade/tree/master/packages/nextclade_cli
[MAFFT]: https://mafft.cbrc.jp/alignment/software/
[shiptv]: https://github.com/peterk87/shiptv
[Pangolin]: https://github.com/cov-lineages/pangolin/